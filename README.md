# PoliticianStat - парсер сведений о проводящихся выборов и кандидатов на избираемые должности с сайта [ЦИК РФ](http//izbirkom.ru/)

## Настройка PostgreSQL
Данные записываются в PostgreSQL. Для этого необходимо: 
1. Создать БД politicians, создать роль dbuser с паролем '1' либо поправить файл dbcon.py и exa1.sql в части подключения и грантов. 
2. Перейти в папку проекта. Подключится к БД от суперпользователя и запустить скрипты в psql
    >\ir 
    
    ```exa1.sql```, ```insert_func.sql```, ```insert_func2.sql``` 
    Эти скрипты создадут схему, таблицы, простые функции insert (в принципе можно обойтись без функций, 
    но мне кажется так наглядней получается уже код на питоне), раздадут права 
    
    Далее
    
    ```trigger.sql```, ```temp_table_func.sql```, ```update_type_region_func.sql```
    
    Эти скрипты "триггерная" связка. Планируется для будущих более гибких фильтров, но пока работает 
    как способ обхода глобальных переменных.

## Технические параметры
Для корректной работы необходим интерпретатор Python 3.6+. 

В случае использования linux - поправить пути к chromedriver в main.py.

Я использую [Git Bash](https://gitforwindows.org/) (всем у кого есть необходимость работать на Windows - must have)
*настройте кодировку 1251 
Также можно его установить в качестве встроенного терминала в IDE 

Настраиваем виртуальную среду в директории проекта:

>pip install virtualenv

>python -m venv env

>source env/Scripts/activate

Устанавливаем модули: 

>pip install requests bs4 selenium lxml 

## Запуск
>python main.py

Набираем начальную дату в формате 01.11.2011

Конечную дату в формате 31.12.2017

Выбираем уровень выборов:
"1" - Федеральный,
"2" - Региональный,
"3" - Административный центр,
"4" - Местное самоуправление.

Выбираем [субъект РФ](https://yadi.sk/i/222tNPSqdz276w): Например "77" - Москва или "78" - Санкт-Петербург 

P.S. Если выбрать большой период времени и уровень местного управления, то можно достаточно долго ждать результата.
Это связано с особенностью работы chromedriver, если позволяет железо, то можно поэкспериментировать с 
multiprocessing особенно если вы на linux, на Windows лучше сделать потоки (# TODO).

P.S.S. Не стоит парсить данные ранее 02.09.2007 (тогда был другой вид отчета). Но это в # TODO :)

## Проверка результатов в psql
>\x

>\ir select_exa.sql

Выведет табличку всех избранных муниципальных депутатов в Москве, которые участвовали в выборах с 18.09.2011 по текущую дату 
(Ваши данные могут отличаться в зависимости от того какие даты вы вводили при парсинге) 

P.S. Для Windows в psql выполнить 
>\\! chcp 1251 

и сохранить файл ```select_exa.sql``` в кодировке 1251 перед выполнением.
